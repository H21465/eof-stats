"use strict";var c=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var T=(e,s,t)=>s in e?c(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var L=(e,s)=>{for(var t in s)c(e,t,{get:s[t],enumerable:!0})},O=(e,s,t,n)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of D(s))!y.call(e,i)&&i!==t&&c(e,i,{get:()=>s[i],enumerable:!(n=x(s,i))||n.enumerable});return e};var b=e=>O(c({},"__esModule",{value:!0}),e);var S=(e,s,t)=>(T(e,typeof s!="symbol"?s+"":s,t),t);var M={};L(M,{default:()=>h});module.exports=b(M);var o=require("obsidian"),l=require("@codemirror/view"),u=require("@codemirror/state");var C=new u.Compartment,g={showUrls:!0,showLinks:!0,statsColor:"#999999",lineColor:"#999999",eofColor:"#999999"};function k(e){let s=e.replace(/^---[\s\S]*?---\n?/,""),t=/https?:\/\/[^\s)\]>]+/g,n=new Set(s.match(t)||[]),i=/\[\[([^\]|#]+)/g,a=new Set,r;for(;(r=i.exec(s))!==null;)a.add(r[1]);return{urls:n.size,links:a.size}}function m(e){return e.toLocaleString()}function P(e,s){let t=[];return s.showUrls&&t.push(`URLs: ${m(e.urls)}`),s.showLinks&&t.push(`Links: ${m(e.links)}`),t.join(" | ")}function F(e,s){let t=document.createElement("div");t.className="eof-stats-container";let n=P(e,s);if(n){let p=t.createEl("div",{cls:"eof-stats-line",text:n});p.style.color=s.statsColor}let i=t.createEl("div",{cls:"eof-indicator"}),a=i.createEl("div",{cls:"eof-line-horizontal"});a.style.borderColor=s.lineColor;let r=i.createEl("div",{cls:"eof-text",text:"EOF"});r.style.color=s.eofColor;let d=i.createEl("div",{cls:"eof-line-horizontal"});return d.style.borderColor=s.lineColor,t}var f=class extends l.WidgetType{constructor(t,n){super();this.stats=t;this.settings=n}toDOM(){return F(this.stats,this.settings)}eq(t){return this.stats.urls===t.stats.urls&&this.stats.links===t.stats.links&&this.settings.showUrls===t.settings.showUrls&&this.settings.showLinks===t.settings.showLinks&&this.settings.statsColor===t.settings.statsColor&&this.settings.lineColor===t.settings.lineColor&&this.settings.eofColor===t.settings.eofColor}};function E(e,s){let t=k(e),n={...s},i=new f(t,n),a=l.Decoration.widget({widget:i,side:1,block:!0});return l.Decoration.set([a.range(e.length)])}function v(e){return u.StateField.define({create(s){return E(s.doc.toString(),e.settings)},update(s,t){return t.docChanged?E(t.state.doc.toString(),e.settings):s.map(t.changes)},provide:s=>l.EditorView.decorations.from(s)})}var w=class extends o.PluginSettingTab{constructor(t,n){super(t,n);S(this,"plugin");this.plugin=n}display(){let{containerEl:t}=this;t.empty(),new o.Setting(t).setName("Display items").setHeading(),new o.Setting(t).setName("Show external links").setDesc("Display the number of unique external links").addToggle(n=>n.setValue(this.plugin.settings.showUrls).onChange(async i=>{this.plugin.settings.showUrls=i,await this.plugin.saveSettings()})),new o.Setting(t).setName("Show links").setDesc("Display the count of unique internal links").addToggle(n=>n.setValue(this.plugin.settings.showLinks).onChange(async i=>{this.plugin.settings.showLinks=i,await this.plugin.saveSettings()})),new o.Setting(t).setName("Colors").setHeading(),new o.Setting(t).setName("Stats color").setDesc("Color for the statistics text").addText(n=>n.setPlaceholder("#999999").setValue(this.plugin.settings.statsColor).onChange(async i=>{this.plugin.settings.statsColor=i||g.statsColor,await this.plugin.saveSettings()})),new o.Setting(t).setName("Line color").setDesc("Color for the horizontal lines").addText(n=>n.setPlaceholder("#999999").setValue(this.plugin.settings.lineColor).onChange(async i=>{this.plugin.settings.lineColor=i||g.lineColor,await this.plugin.saveSettings()})),new o.Setting(t).setName("End-of-file color").setDesc("Color for the end-of-file text").addText(n=>n.setPlaceholder("#999999").setValue(this.plugin.settings.eofColor).onChange(async i=>{this.plugin.settings.eofColor=i||g.eofColor,await this.plugin.saveSettings()}))}},h=class extends o.Plugin{constructor(){super(...arguments);S(this,"settings")}async onload(){await this.loadSettings(),this.addSettingTab(new w(this.app,this)),this.registerEditorExtension(C.of(v(this))),this.registerMarkdownPostProcessor((t,n)=>{this.addEOFToReadingView(t,n)})}onunload(){}async loadSettings(){this.settings=Object.assign({},g,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.updateEditorExtension()}updateEditorExtension(){this.app.workspace.iterateAllLeaves(t=>{var n,i;if(t.view instanceof o.MarkdownView){let a=(n=t.view.editor)==null?void 0:n.cm;a&&(a.dispatch({effects:C.reconfigure(v(this))}),a.requestMeasure()),(i=t.view.previewMode)==null||i.rerender(!0)}})}addEOFToReadingView(t,n){let i=n.getSectionInfo(t);if(!i)return;let a=this.app.vault.getAbstractFileByPath(n.sourcePath);!a||!(a instanceof o.TFile)||this.app.vault.cachedRead(a).then(r=>{let d=r.split(`
`).length-1;if(i.lineEnd>=d){let p=k(r);t.appendChild(F(p,this.settings))}}).catch(()=>{})}};
